!function(M){"use strict";var J="ht",w=M[J],Z=w.Default,e=Math,X=e.PI,x=2*X,q=e.sin,P=e.cos,S=e.atan2,o=e.sqrt,u=e.max,I=e.floor,A=(e.round,e.ceil),z=e.abs,V=w.Shape,f=w.Edge,h=w.List,n=w.Style,b=w.graph,p=Z.getInternal(),L=p.ui(),B=null,i="__segmentLengths",v="__lineTotalLength",O="__linePoints",c="__distance0",y="flow.count",D="flow.step",U="flow.element.max",H="flow.element.count",G="flow.element.min",$="flow.element.space",_="flow.element.autorotate",m="flow.element.background",T="flow.element.shadow.max",t="flow.element.shadow.min",Y="flow.element.shadow.begincolor",F="flow.element.shadow.endcolor",k="flow.element.shadow.visible",Q="flow.element.image",g="flow",K="prototype",j=b.GraphView[K],N=w.Data[K],R=L.DataUI[K],E=L.ShapeUI[K],s=L.EdgeUI[K],a=w.DataModel[K],r=E._80o,W=s._80o,l=a.prepareRemove,C=s._79o,d=E._79o,Od=j.setDataModel,jk=function(H){return document.createElement(H)};j.calculatePointLength=function(z,M,t){var O=this,Q=O.getDataUI(z);t==B&&(t=.1);var P=ki(Q),d=[];if(P){for(var n=P.length,g=0;n>g;g++){var i=P[g];i._as&&(i=i._as);for(var l=i[0],X=1;X<i.length;X++)d.push([l,i[X]]),l=i[X]}for(var W=[],g=0;g<d.length;g++){var w=us(d[g][0],d[g][1],M);W.push(w)}var $=W.slice(0);$.sort(function(c,O){return c.z>O.z?1:c.z<O.z?-1:0});var U=$[0];if(U.z<t){for(var r=W.indexOf(U),K=0,g=0;r>=g;g++)K+=r>g?Z.getDistance(d[g][0],d[g][1]):Z.getDistance(d[g][0],U);return K}}},Z.calculatePointLength=function(s,$,z,F){F==B&&(F=.1);var j=ki(B,s,$),$=[];if(j){for(var W=j.length,J=0;W>J;J++){var K=j[J];K._as&&(K=K._as);for(var D=K[0],c=1;c<K.length;c++)$.push([D,K[c]]),D=K[c]}for(var e=[],J=0;J<$.length;J++){var P=us($[J][0],$[J][1],z);e.push(P)}var H=e.slice(0);H.sort(function(a,T){return a.z>T.z?1:a.z<T.z?-1:0});var _=H[0];if(_.z<F){for(var x=e.indexOf(_),o=0,J=0;x>=J;J++)o+=x>J?Z.getDistance($[J][0],$[J][1]):Z.getDistance($[J][0],_);return o}}},j.calculateClosestPoint=function(m,w){var p=this,_=p.getDataUI(m),o=ki(_),A=[];if(o){for(var e=o.length,i=0;e>i;i++){var I=o[i];I._as&&(I=I._as);for(var H=I[0],t=1;t<I.length;t++)A.push([H,I[t]]),H=I[t]}for(var Q=[],i=0;i<A.length;i++){var P=us(A[i][0],A[i][1],w);Q.push(P)}return Q.sort(function(W,K){return W.z>K.z?1:W.z<K.z?-1:0}),Q[0]}},Z.calculateClosestPoint=function(x,V,F){var r=ki(B,x,V),V=[];if(r){for(var t=r.length,I=0;t>I;I++){var P=r[I];P._as&&(P=P._as);for(var e=P[0],y=1;y<P.length;y++)V.push([e,P[y]]),e=P[y]}for(var R=[],I=0;I<V.length;I++){var d=us(V[I][0],V[I][1],F);R.push(d)}return R.sort(function(F,o){return F.z>o.z?1:F.z<o.z?-1:0}),R[0]}},j.getPercentAngle=function(O,G){var l=this,V=l.getDataUI(O),D=O.getRotation?O.getRotation():0,h=ki(V);if(h)if(0===G){var Q=h[0][0],j=h[0][1];D+=S(j.y-Q.y,j.x-Q.x)}else if(100===G){h=h[h.length-1];var Q=h[h.length-2],j=h[h.length-1];D+=S(j.y-Q.y,j.x-Q.x)}else{for(var U=0,E=[],P=h.length,y=0;P>y;y++){var g=h[y],k=Dq(g);U+=k,E.push(k)}for(var Y=U*G/100,$=sm(Y,E),s=0,m=0;$>m;m++)s+=E[m];Y-=s;for(var e=Wk(h[$],Y),H=h[$],Z=0,i=0,v=0;v<H.length-1;v++){var x=H[v],B=H[v+1],W=B.x-x.x,r=B.y-x.y,L=o(W*W+r*r);if(Z+=L,Z>Y){i=v;break}}var J=H[i];D+=S(e.y-J.y,e.x-J.x)}return D},Z.getPercentAngle=function(T,d,a){var g=0,A=ki(B,T,d);if(A)if(0===a){var D=A[0][0],c=A[0][1];g+=S(c.y-D.y,c.x-D.x)}else if(100===a){A=A[A.length-1];var D=A[A.length-2],c=A[A.length-1];g+=S(c.y-D.y,c.x-D.x)}else{for(var M=0,W=[],C=A.length,J=0;C>J;J++){var w=A[J],P=Dq(w);M+=P,W.push(P)}for(var G=M*a/100,s=sm(G,W),y=0,R=0;s>R;R++)y+=W[R];G-=y;for(var I=Wk(A[s],G),U=A[s],b=0,u=0,k=0;k<U.length-1;k++){var f=U[k],v=U[k+1],L=v.x-f.x,K=v.y-f.y,m=o(L*L+K*K);if(b+=m,b>G){u=k;break}}var F=U[u];g+=S(I.y-F.y,I.x-F.x)}return g},j.calculateLength=function(B){var O=this,e=O.getDataUI(B),l=ki(e),$=0;if(l)if(Array.isArray(l[0]))for(var H=l.length,J=0;H>J;J++){var a=l[J],V=Dq(a);$+=V}else $=Dq(l);return $},Z.calculateLength=function(l,j){var l=ki(B,l,j),Y=0;if(l)if(Array.isArray(l[0]))for(var I=l.length,C=0;I>C;C++){var g=l[C],Q=Dq(g);Y+=Q}else Y=Dq(l);return Y};var us=Z.calculateClosestPointOnLine=function(g,w,_){var o=g.x,m=g.y,B=w.x,T=w.y,x=_.x,b=_.y,q={},f=B-o,Q=T-m,v=Math.sqrt(f*f+Q*Q),k=f/v,e=Q/v,l=(-o+x)*k+(-m+b)*e;return q.x=o+l*k,q.y=m+l*e,Cf(q,g,w)||(q.x=Math.abs(q.x-g.x)<Math.abs(q.x-w.x)?g.x:w.x,q.y=Math.abs(q.y-g.y)<Math.abs(q.y-w.y)?g.y:w.y),f=x-q.x,Q=b-q.y,q.z=Math.sqrt(f*f+Q*Q),q},Cf=function(f,x,F){return f.x>=Math.min(x.x,F.x)&&f.x<=Math.max(x.x,F.x)&&f.y>=Math.min(x.y,F.y)&&f.y<=Math.max(x.y,F.y)},Dq=function(m){for(var d=0,l=m.length-1,U=0;l>U;U++){var J=m[U],P=m[U+1],j=P.x-J.x,Q=P.y-J.y,S=o(j*j+Q*Q);d+=S}return d},Wk=function(T,Y){for(var X=0,s=0,Q=0,C=T.length-1,x=0;C>x;x++){var D=T[x],e=T[x+1],b=e.x-D.x,K=e.y-D.y;if(Q=o(b*b+K*K),X+=Q,X>Y){X-=Q,s=x;break}}var i=T[s],r=T[s+1],$=S(r.y-i.y,r.x-i.x),y=Y-X,K=q($)*y,b=P($)*y;return{x:i.x+b,y:i.y+K}},Lg=function(u,H,j,I){var i=P(I),x=q(I),o=i*H-x*j,w=x*H+i*j;return u?{x:u.x+o,y:u.y+w}:{x:o,y:w}},Ln=function(a,q){a[i]=a[v]=a[O]=q[c]=B},Rf=function(j,U,H,h,Q,e){var s,k,D,o,w,c,Z,T,N,Y,V,b=[];if(z(h)>x&&(h=x),w=A(z(h)/(X/4)),s=h/w,k=-s,D=-H,w>0){c=j+P(H)*Q,Z=U+q(-H)*e,b.push({x:c,y:Z});for(var m=0;w>m;m++)D+=k,o=D-k/2,T=j+P(D)*Q,N=U+q(D)*e,Y=j+P(o)*(Q/P(k/2)),V=U+q(o)*(e/P(k/2)),b.push({x:Y,y:V}),b.push({x:T,y:N})}return b},ki=function(b,H,i){if(H==B){var C=b._data;if(C instanceof V){if(H=C.getPoints(),i=C.getSegments(),(!i||0===i.size())&&H){i=new w.List([1]);for(var G=1;G<H.size();G++)i.add(2)}}else if(C instanceof f){var W=b._78o;if(W){var N=W.type,J=W.points,X=W.segments,t=W.edgeTypeInfo;if(!N||J){var u=W.sourcePoint,S=u.x,y=u.y,r=W.targetPoint,Y=r.x,M=r.y;if(N)X?(H=new h({x:S,y:y}),H.addAll(J),H.add({x:Y,y:M}),i=new h(X._as)):(H=new h({x:S,y:y}),i=new h([1]),J.each(function(P){H.add(P),i.add(2)}),H.add({x:Y,y:M}),i.add(2));else if(W.looped){H=new h(Rf(S,y,0,x,W.radius,W.radius)),i=new h([1]);for(var G=0;G<(H.size()-1)/2;G++)i.add(3)}else H=new h,W.center?(H.add({x:W.c1.x,y:W.c1.y}),H.add({x:S,y:y}),H.add({x:Y,y:M}),H.add({x:W.c2.x,y:W.c2.y}),i=new h([1,2,2,2])):(H.add({x:S,y:y}),H.add({x:Y,y:M}),i=new h([1,2]))}else if(t)if(H=new h(t.points._as),t.segments)i=new h(t.segments._as);else{i=new h([1]);for(var G=1;G<t.points.size();G++)i.add(2)}}}}if(H){if(Array.isArray(H)&&(H=new h(H)),"number"==typeof H.get(0)){for(var d=new w.List,G=0;G<H.size();G+=2)d.add({x:H.get(G),y:H.get(G+1)});H=d}if(!i){i=[];for(var G=0;G<H.size();G++)0===G?i.push(1):i.push(2)}Array.isArray(i)&&(i=new h(i));for(var I=p.toPointsArray(H._as,i._as,50),P=I.length,o=[],G=0;P>G;G++){var Z=I[G];Z.length>1&&o.push(Z)}return o}},qe=function(h){var p=h._data,q=ki(h);if(q){p.s("flow.reverse")&&(q.reverse(),q.forEach(function(t){t.reverse()}));for(var k=0,T=[],x=q.length,a=0;x>a;a++){var w=q[a],J=Dq(w);k+=J,T.push(J)}if(p[i]=T,p[v]=k,p[O]=q,p instanceof f){var H=Z.unionPoint(q),m=H.x+H.width/2,l=H.y+H.height/2;p.$10e={x:m,y:l}}ib(h,!0)}},ib=(Z.getPercentPositionOnPoints=function(Y,F,L){if(Y){var w=ki(B,Y,F);if(w){var W;if(0===L)W=w[0][0];else if(100===L)w=w[w.length-1],W=w[w.length-1];else{for(var z=0,n=[],H=w.length,T=0;H>T;T++){var G=w[T],u=Dq(G);z+=u,n.push(u)}for(var v=z*L/100,s=sm(v,n),k=0,N=0;s>N;N++)k+=n[N];v-=k,W=Wk(w[s],v)}return W}}},j.getPercentPosition=function(e,j){var g=this,V=g.getDataUI(e),$=ki(V);if($){var w;if(0===j)w=$[0][0];else if(100===j)$=$[$.length-1],w=$[$.length-1];else{for(var Y=0,q=[],E=$.length,F=0;E>F;F++){var P=$[F],U=Dq(P);Y+=U,q.push(U)}for(var z=Y*j/100,R=sm(z,q),d=0,n=0;R>n;n++)d+=q[n];z-=d,w=Wk($[R],z)}return w}},function(x,p){var N=x._data,u=N[v],n=N.s(y),J=N.s(D),F=0,B=N[i],r=N.s(U),K=N.s(G),W=N.s(H),d=(r-K)/(W-1),t=[];if(B){if(1===W)t.push(r);else if(2===W)t.push(r),t.push(K);else{if(!(W>2))return;t.push(r);for(var O=W-2;O>0;O--)t.push(K+d*O);t.push(K)}var b=0,C=0;t.forEach(function(q){W-1>b&&(C+=N.getFlowElementSpace(q)),b++}),C+=(r+K)/2,F=(u-n*C+C)/n;var A=x[c];for(null==A&&(A=0),p||(A+=J);A>u+C;){var o=x._overCount;o?o++:o=1,o>=n&&(o=null),x._overCount=o,N.s("flow.autoreverse")?o?A-=F+C:(A=0,N.s("flow.reverse",!N.s("flow.reverse"))):A-=F+C}x[c]=A}}),vs=function(o){var M=o.data,N=this.dm();if(M&&"add"===o.kind){var G=N.$3e;G&&M.s(g)&&G.indexOf(M)<0&&G.push(M)}"clear"===o.kind&&(N.$3e=[])},Si=function(r){var N=r.property,L=r.data,J=r.newValue,z=this.dm().$3e;if(z&&"s:flow"===N)if(J)z.indexOf(L)<0&&z.push(L);else for(var A=z.length,y=0;A>y;y++)if(z[y]===L){z.splice(y,1);break}},sm=sm=function(Z,r){for(var d=0,P=r.length,h=0;P>h;h++){var f=r[h];if(d+=f,d>Z)return h}return Math.min(h,P-1)},ni=function(Z){var A=this,e=A._data,D=e[v],q=e[i],K=e[O],C=e.s(y),l=0,u=A[c],j=e.s(U),N=e.s(G),z=e.s(H),E=e.s(t),d=e.s(T),g=e.s(_),X=(d-E)/(z-1),h=(j-N)/(z-1),W=e.getRotation?e.getRotation():0,R=e.getPosition?e.p():e.$10e,b=[],f=[];if(u!=B){if(1===z)b.push(j);else if(2===z)b.push(j),b.push(N);else{if(!(z>2))return;b.push(j);for(var P=z-2;P>0;P--)b.push(N+h*P);b.push(N)}if(1===z)f.push(d);else if(2===z)f.push(d),f.push(E);else{if(!(z>2))return;f.push(d);for(var P=z-2;P>0;P--)f.push(E+X*P);f.push(E)}var M=0,r=0;b.forEach(function(f){z-1>M&&(r+=e.getFlowElementSpace(f)),M++}),r+=(j+N)/2,l=(D-C*r+r)/C,Z.save();for(var P=0;C>P;P++){var Y=u,J=0,a=A._overCount,s=0;e.s("flow.autoreverse")&&a&&a>C-(P+1)||(Y-=P*(l+r),M=0,b.forEach(function($){var B=Y-J;if(B>=0&&D>B){var j=!0,Q=sm(B,q);s=0;for(var E=0;Q>E;E++)s+=q[E];if(B-=s,j){var x=Wk(K[Q],B),c=W;if(g){for(var O=K[Q],C=0,d=0,H=0;H<O.length-1;H++){var F=O[H],i=O[H+1],m=i.x-F.x,w=i.y-F.y,V=o(m*m+w*w);if(C+=V,C>B){d=H;break}}var n=O[d];c+=S(x.y-n.y,x.x-n.x)}W&&(x=Lg(R,x.x-R.x,x.y-R.y,W)),A.$5e(Z,x,$,f[M],c)}}J+=e.getFlowElementSpace(b[M]),M++}))}Z.restore()}},Ef=function(){var t=this,r=t._data,O=r.s(U),m=!1,I=B;if(t._6I||(m=!0),I=r instanceof f?C.call(t):d.call(t),r.s(g)&&m){var a=r.s(T),M=r.s(k);M&&a>O&&(O=a),O>0&&Z.grow(I,A(O/2)),qe(t)}return!r.s(g)&&m&&Ln(r,t),I};N.getFlowElementSpace=function(){return this.s($)},E._79o=Ef,s._79o=Ef,n[U]==B&&(n[U]=7),n[G]==B&&(n[G]=0),n[y]==B&&(n[y]=1),n[D]==B&&(n[D]=3),n[H]==B&&(n[H]=10),n[$]==B&&(n[$]=3.5),n[_]==B&&(n[_]=!1),n[m]==B&&(n[m]="rgba(255, 255, 114, 0.4)"),n[Y]==B&&(n[Y]="rgba(255, 255, 0, 0.3)"),n[F]==B&&(n[F]="rgba(255, 255, 0, 0)"),n[k]==B&&(n[k]=1),n[T]==B&&(n[T]=22),n[t]==B&&(n[t]=4),a.prepareRemove=function(E){l.call(this,E);var _=E._dataModel,i=_.$3e;if(i)for(var U=i.length,T=0;U>T;T++)if(i[T]===E){i.splice(T,1);break}},j.setDataModel=function(B){var o=this,A=o._dataModel;if(A!==B){A&&(A.umm(vs,o),A.umd(Si,o),A.$3e=[]),B.mm(vs,o),B.md(Si,o);var n=B.$3e=[];B.each(function(x){x.s(g)&&n.indexOf(x)<0&&n.push(x)}),Od.call(o,B)}},j.setFlowInterval=function(H){var S=this,T=S.$11e;S.$11e=H,S.fp("flowInterval",T,H),S.$7e!=B&&(clearInterval(S.$7e),delete S.$7e,S.enableFlow(H))},j.getFlowInterval=function(){return this.$11e},j.$9e=function(){var r,Y,W,n=this,V=n.tx(),g=n.ty(),z=n.getZoom(),t=n.getWidth(),j=n.getHeight(),c={x:-V/z,y:-g/z,width:t/z,height:j/z},J=n.dm().$3e,_=n._56I,O=new h;if(J.forEach(function(b){_[b.getId()]&&(r=n.getDataUI(b),r&&(W=r._79o(),W&&O.add(W)))}),0!==O.size()&&(O.each(function(q){Z.intersectsRect(c,q)&&(Y=Z.unionRect(Y,q))}),Y&&(Y&&(Z.grow(Y,u(1,1/z)),Y.x=I(Y.x*z)/z,Y.y=I(Y.y*z)/z,Y.width=A(Y.width*z)/z,Y.height=A(Y.height*z)/z,Y=Z.intersection(c,Y)),Y))){var q=n._canvas.getContext("2d");q.save(),q.lineCap=Z.lineCap,q.lineJoin=Z.lineJoin,p.translateAndScale(q,V,g,z),q.beginPath(),q.rect(Y.x,Y.y,Y.width,Y.height),q.clip(),q.clearRect(Y.x,Y.y,Y.width,Y.height),n.$6e(q,Y),q.restore()}},j.$6e=function(V,F){var M,Y,m=this;m._93db(V),m.each(function(c){m._56I[c._id]&&(M=m.getDataUI(c),M&&(Y=M._79o(),(!F||Z.intersectsRect(F,Y))&&M._42(V)))}),m._92db(V)},j.enableFlow=function(k){var R=this,e=R.dm(),i=e.$3e;R.$7e==B&&(i.forEach(function(z){var n=R.getDataUI(z);qe(n)}),R.$7e=setInterval(function(){e.$3e.forEach(function(L){ib(R.getDataUI(L))}),R.$9e()},k||R.$11e||50))},j.disableFlow=function(){var l=this;clearInterval(l.$7e),delete l.$7e;var m=l.dm().$3e;m&&l.$9e()},R.$5e=function(C,i,u,_,c){var h=this,K=h._data,l=h.gv,R=K.s(m),V=K.s(Y),n=K.s(F),P=K.s(k),D=l.$8e,M=K.s(Q);if(D==B&&(D=l.$8e={}),C.beginPath(),M!=B){var q=Z.getImage(M),I=u/2;C.translate(i.x,i.y),C.rotate(c),C.translate(-i.x,-i.y),Z.drawImage(C,q,i.x-I,i.y-I,u,u,K),C.translate(i.x,i.y),C.rotate(-c),C.translate(-i.x,-i.y)}else C.fillStyle=R,C.arc(i.x,i.y,u/2,0,x,!0),C.fill();if(P){var T=22,v=T+"_"+V+"_"+n,t=D[v];if(t==B){var G=jk("canvas");p.setCanvas(G,T,T);var E=G.getContext("2d"),s=T/2,f=s,j=s;p.translateAndScale(E,0,0,1),E.beginPath();var H=E.createRadialGradient(f,j,0,f,f,s);H.addColorStop(0,V),H.addColorStop(1,n),E.fillStyle=H,E.arc(f,j,s,0,x,!0),E.fill(),t=D[v]=G}var I=_/2;Z.drawImage(C,t,i.x-I,i.y-I,_,_,K)}},s._80o=function($){W.call(this,$);var U=this,y=U._data,l=U.gv;y.s(g)&&l.$7e!=B&&ni.call(U,$)},E._80o=function(R){r.call(this,R);var Z=this,S=Z._data,V=Z.gv;S.s(g)&&V.$7e!=B&&ni.call(Z,R)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);